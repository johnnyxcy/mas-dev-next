include:
    - local: .gitlab/ci/cache.gitlab-ci.yml
    - local: .gitlab/ci/variables.gitlab-ci.yml

prepare-node-dependencies: # å¤„ç† node ç¯å¢ƒä¾èµ–ç›¸å…³
    stage: .pre
    extends: .update-node_modules-cache
    rules:
        - changes:
              paths:
                  - yarn.lock
              compare_to: HEAD~
    tags:
        - windows
    retry: 2
    script:
        - echo "ğŸš… æ­£åœ¨å‡†å¤‡æ–°çš„ node_modules ç¼“å­˜..."
        - yarn --frozen-lockfile --network-timeout 1000000

prepare-python-dependencies:  # å¤„ç† python ç¯å¢ƒä¾èµ–ç›¸å…³
    stage: .pre
    rules:
        - changes:
              paths:
                  - poetry.lock
              compare_to: HEAD~
    extends: .update-python-cache
    tags:
        - windows
    script:
        - echo "ğŸš… æ­£åœ¨å‡†å¤‡æ–°çš„ python ç¼“å­˜..."
        - python -m pip install -U poetry==1.4.0
        - python -m poetry install --no-root

prepare-cxx-dependencies:  # å¤„ç† python ç¯å¢ƒä¾èµ–ç›¸å…³
    stage: .pre
    rules:
        - changes:
              paths:
                  - mas/vendor/package.json
              compare_to: HEAD~
    extends: .update-cxx-cache
    variables:
        PREPARE_CXX_BOOST_BUILD_DIR: "${CI_PROJECT_DIR}/buildboost"
    tags:
        - windows
    script:
        - echo "ğŸš… æ­£åœ¨å‡†å¤‡æ–°çš„ CXX .local ç¼“å­˜..."
        - python ./common/scripts/prepare_cxx.py
